<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just2Numbers.com</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container">
    <div class="image-container">
        <img src="Just2Numbers.jpeg" alt="Just2Numbers Image">
    </div>
    <h1>Just2Numbers</h1>
    <!-- <h2>Your Location</h2> -->
    <div class="location" id="location">Fetching location...</div>
    <br>
    <button class="copy-button" id="copyButton" onclick="copyLocation()" style="display:none;">Copy Location</button>
    <div>
    <button onclick="getLocation()">Refresh Location</button>
    </div>
    <div>
        Just2Numbers provides a simple web interface to show the current location in an open and flexible format. 
        Clickable links are provided to allow location data to be displayed or shared via various different mechanisms such as WhatsApp, Facebook etc.<br>
        Privacy: Just2Numbers runs code in the browser and is entirely static content. Just2Numbers does not currently use cookies. Just2Numbers does not see or collect any location data from end users.<br>
    </div>
</div>

<script>

    const wgs84 = '+proj=longlat +datum=WGS84 +no_defs';
    const osgb36 = '+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.999601271 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=375.0,111.0,442.0,0.0,0.0,0.0,0.0 +units=m +no_defs';


    // function isLocationInUK(lat, long) {
    //     const northernmost = 60.847;
    //     const southernmost = 49.959;
    //     const westernmost = -8.649;
    //     const easternmost = 1.768;

    //     return lat <= northernmost && lat >= southernmost && long <= easternmost && long >= westernmost;
    // }


    // document.getElementById('coordForm').addEventListener('submit', function(event) {
    //     event.preventDefault();
    //     const lat = parseFloat(document.getElementById('latitude').value);
    //     const long = parseFloat(document.getElementById('longitude').value);
    //     const gridRef = latLongToGridRef(lat, long);
    //     document.getElementById('result').innerText = `Grid Reference: ${gridRef}`;
    // });

    // function latLongToGridRef(lat, long) {
    //     const [easting, northing] = proj4(wgs84, osgb36, [long, lat]);
    //     return os.Transform.fromLatLng({ lat, long });
    //     return convertToGridReference(easting, northing);
    // }

    // function convertToGridReference(easting, northing) {
    //     // Calculate the grid square
    //     const eastingInt = Math.floor(easting);
    //     const northingInt = Math.floor(northing);

    //     // Determine the grid letters
    //     const eastingLetter = String.fromCharCode(65 + Math.floor(eastingInt / 100000) % 5);
    //     const northingLetter = String.fromCharCode(65 + Math.floor(northingInt / 100000) % 5);

    //     // Calculate the numeric part of the grid reference
    //     const eastingPart = eastingInt % 100000;
    //     const northingPart = northingInt % 100000;

    //     // Format the grid reference
    //     const gridRef = `${eastingLetter}${northingLetter} ${String(eastingPart).padStart(6, '0')} ${String(northingPart).padStart(6, '0')}`;
    //     return gridRef;
    // }



    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
        }
    }


    function showPosition(position) {
        const lat = position.coords.latitude;
        const long = position.coords.longitude;
        const locationText = `Latitude, Longitude: ${lat}, ${long}`;
        const commaDelimited = `${lat},${long}`;
        const googleMapsText = 'https://www.google.com/maps?q=' + commaDelimited;
        const fullLocationText = locationText + '\n' + googleMapsText + '\n' + 'Position Data From www.Just2Numbers.com';
        document.getElementById("location").innerHTML = locationText;

        const googleMapsLink = `https://www.google.com/maps/?=${lat},${long},17z`;
        const bingMapsLink = `https://www.bing.com/maps?cp=${lat}~${long}&lvl=17.0`;
        const megpMapsLink = `https://www.megalithic.co.uk/le_megalith_map_os.html#10/${lat}/${long}`;

        document.getElementById("location").innerHTML += `
            <a class="link" href="${googleMapsLink}" target="_blank">View on Google Maps</a>
            <a class="link" href="${bingMapsLink}" target="_blank">View on Bing Maps</a>
            <a class="link" href="sms:?body=${encodeURIComponent(fullLocationText)}">Send via SMS</a>
            <a class="link" href="mailto:?subject=My Location&body=${encodeURIComponent(fullLocationText)}">Send via Email</a>
            <a class="link" href="https://wa.me/?text=${encodeURIComponent(fullLocationText)}" target="_blank">Share on WhatsApp</a>
            <a class="link" href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullLocationText)}" target="_blank">Share on Facebook</a>
            <a class="link" href="${megpMapsLink}" target="_blank">View on Megalithic Portal Maps</a>
        `;

        // if ( isLocationInUK( lat, long ))
        // {
        //     const gridRef = latLongToGridRef(lat, long);
        //     document.getElementById("location").innerHTML += 'UK Grid Ref ' + gridRef;
        // }

        // Show the copy button
        const copyButton = document.getElementById("copyButton");
        copyButton.style.display = "block";
        copyButton.setAttribute("data-clipboard-text", commaDelimited);

    }

    function copyLocation() {
        const lat = document.getElementById("location").innerText.match(/^Latitude,\s*Longitude:\s*([-+]?\d*\.\d+),\s*([-+]?\d*\.\d+)/);
        if (lat) {
            const commaDelimited = `${lat[1]}, ${lat[2]}`;
            navigator.clipboard.writeText(commaDelimited).then(() => {
                alert("Location copied");
            }).catch(err => {
                console.error("Failed to copy: ", err);
            });
        }
    }


    function showError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
                document.getElementById("location").innerHTML = "User denied the request for Geolocation.";
                break;
            case error.POSITION_UNAVAILABLE:
                document.getElementById("location").innerHTML = "Location information is unavailable.";
                break;
            case error.TIMEOUT:
                document.getElementById("location").innerHTML = "The request to get user location timed out.";
                break;
            case error.UNKNOWN_ERROR:
                document.getElementById("location").innerHTML = "An unknown error occurred.";
                break;
        }
    }

    window.onload = getLocation;
</script>    

</body>
</html>
